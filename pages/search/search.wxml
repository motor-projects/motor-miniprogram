<!--pages/search/search.wxml-->
<view class="page">
  <!-- æœç´¢æ¡† -->
  <view class="search-header">
    <view class="search-box">
      <input class="search-input" 
             placeholder="æœç´¢æ‘©æ‰˜è½¦å‹å·ã€å“ç‰Œ" 
             value="{{searchKeyword}}"
             bindinput="onSearchInput"
             bindconfirm="performSearch"
             confirm-type="search"
             focus="{{showKeyboard}}"
             cursor-spacing="10"/>
      <view class="search-actions">
        <text class="clear-btn" wx:if="{{searchKeyword}}" bindtap="clearSearch">âœ•</text>
        <text class="search-btn" bindtap="performSearch">æœç´¢</text>
      </view>
    </view>
    <text class="cancel-btn" bindtap="goBack">å–æ¶ˆ</text>
  </view>

  <!-- æœç´¢å»ºè®® -->
  <view class="search-suggestions" wx:if="{{showSuggestions && suggestions.length > 0}}">
    <view class="suggestion-item" 
          wx:for="{{suggestions}}" 
          wx:key="*this"
          bindtap="selectSuggestion" 
          data-keyword="{{item}}">
      <text class="suggestion-icon">ğŸ”</text>
      <text class="suggestion-text">{{item}}</text>
    </view>
  </view>

  <!-- æœç´¢å†å²å’Œçƒ­é—¨æœç´¢ -->
  <view class="search-content" wx:if="{{!showResults}}">
    <!-- æœç´¢å†å² -->
    <view class="history-section" wx:if="{{searchHistory.length > 0}}">
      <view class="section-header">
        <text class="section-title">æœç´¢å†å²</text>
        <text class="clear-all" bindtap="clearHistory">æ¸…ç©º</text>
      </view>
      <view class="history-tags">
        <view class="history-tag" 
              wx:for="{{searchHistory}}" 
              wx:key="*this"
              bindtap="selectHistory" 
              data-keyword="{{item}}">
          {{item}}
          <text class="remove-tag" bindtap="removeHistory" data-keyword="{{item}}" catchtap="true">âœ•</text>
        </view>
      </view>
    </view>

    <!-- çƒ­é—¨æœç´¢ -->
    <view class="hot-section">
      <view class="section-header">
        <text class="section-title">çƒ­é—¨æœç´¢</text>
      </view>
      <view class="hot-tags">
        <view class="hot-tag" 
              wx:for="{{hotKeywords}}" 
              wx:key="*this"
              bindtap="selectHotKeyword" 
              data-keyword="{{item}}">
          {{item}}
        </view>
      </view>
    </view>

    <!-- çƒ­é—¨å“ç‰Œ -->
    <view class="brands-section">
      <view class="section-header">
        <text class="section-title">çƒ­é—¨å“ç‰Œ</text>
      </view>
      <view class="brands-grid">
        <view class="brand-item" 
              wx:for="{{hotBrands}}" 
              wx:key="name"
              bindtap="selectBrand" 
              data-brand="{{item.name}}">
          <image src="{{item.logo}}" class="brand-logo"></image>
          <text class="brand-name">{{item.name}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- æœç´¢ç»“æœ -->
  <view class="search-results" wx:if="{{showResults}}">
    <!-- ç­›é€‰æ  -->
    <view class="filter-bar">
      <view class="filter-item" bindtap="showSortOptions">
        <text class="filter-text">{{sortText}}</text>
        <text class="filter-arrow">â–¼</text>
      </view>
      <view class="filter-item" bindtap="showMoreFilters">
        <text class="filter-text">ç­›é€‰</text>
        <text class="filter-arrow">â–¼</text>
      </view>
      <view class="result-count">
        <text>å…±{{totalCount}}ä¸ªç»“æœ</text>
      </view>
    </view>

    <!-- æ‘©æ‰˜è½¦åˆ—è¡¨ -->
    <view class="motorcycle-list">
      <view class="motorcycle-item" 
            wx:for="{{searchResults}}" 
            wx:key="_id"
            bindtap="goToDetail" 
            data-id="{{item._id}}">
        <image src="{{item.images[0].url}}" class="motorcycle-image" mode="aspectFill"></image>
        <view class="motorcycle-info">
          <view class="info-header">
            <text class="motorcycle-name">{{item.brand}} {{item.model}}</text>
            <text class="motorcycle-year">{{item.year}}å¹´</text>
          </view>
          <text class="motorcycle-price">Â¥{{item.price.msrp}}</text>
          <view class="motorcycle-specs">
            <text class="spec-item">{{item.engine.displacement}}cc</text>
            <text class="spec-item">{{item.performance.power.hp}}HP</text>
            <text class="spec-item">{{item.category}}</text>
          </view>
          <view class="rating" wx:if="{{item.rating}}">
            <view class="stars">
              <text class="star {{index < item.rating.overall ? 'filled' : ''}}" 
                    wx:for="{{[1,2,3,4,5]}}" wx:key="*this">â˜…</text>
            </view>
            <text class="rating-text">{{item.rating.reviews}}æ¡è¯„ä»·</text>
          </view>
        </view>
        <view class="action-buttons">
          <text class="favorite-btn {{item.isFavorited ? 'favorited' : ''}}" 
                bindtap="toggleFavorite" 
                data-id="{{item._id}}" 
                catchtap="true">â™¡</text>
          <text class="compare-btn" 
                bindtap="addToCompare" 
                data-id="{{item._id}}" 
                catchtap="true">å¯¹æ¯”</text>
        </view>
      </view>
    </view>

    <!-- åŠ è½½æ›´å¤š -->
    <view class="load-more" wx:if="{{hasMore && !loading}}">
      <text class="load-more-text" bindtap="loadMore">åŠ è½½æ›´å¤š</text>
    </view>

    <!-- åŠ è½½ä¸­ -->
    <view class="loading" wx:if="{{loading}}">
      <text>æœç´¢ä¸­...</text>
    </view>

    <!-- ç©ºç»“æœ -->
    <view class="empty-result" wx:if="{{searchResults.length === 0 && !loading && showResults}}">
      <image src="/images/empty-search.png" class="empty-icon"></image>
      <text class="empty-text">æ²¡æœ‰æ‰¾åˆ°ç›¸å…³æ‘©æ‰˜è½¦</text>
      <text class="empty-tip">è¯•è¯•å…¶ä»–å…³é”®è¯</text>
    </view>
  </view>

  <!-- æ’åºé€‰é¡¹é¢æ¿ -->
  <view class="sort-panel" wx:if="{{showSortPanel}}">
    <view class="panel-mask" bindtap="hideSortPanel"></view>
    <view class="panel-content">
      <view class="panel-header">
        <text class="panel-title">æ’åºæ–¹å¼</text>
        <text class="panel-close" bindtap="hideSortPanel">âœ•</text>
      </view>
      <view class="sort-options">
        <view class="sort-option {{sortBy === 'relevance' ? 'active' : ''}}" 
              bindtap="selectSort" 
              data-sort="relevance">
          <text class="option-text">ç›¸å…³åº¦</text>
          <text class="option-check" wx:if="{{sortBy === 'relevance'}}">âœ“</text>
        </view>
        <view class="sort-option {{sortBy === 'price_asc' ? 'active' : ''}}" 
              bindtap="selectSort" 
              data-sort="price_asc">
          <text class="option-text">ä»·æ ¼ä»ä½åˆ°é«˜</text>
          <text class="option-check" wx:if="{{sortBy === 'price_asc'}}">âœ“</text>
        </view>
        <view class="sort-option {{sortBy === 'price_desc' ? 'active' : ''}}" 
              bindtap="selectSort" 
              data-sort="price_desc">
          <text class="option-text">ä»·æ ¼ä»é«˜åˆ°ä½</text>
          <text class="option-check" wx:if="{{sortBy === 'price_desc'}}">âœ“</text>
        </view>
        <view class="sort-option {{sortBy === 'year_desc' ? 'active' : ''}}" 
              bindtap="selectSort" 
              data-sort="year_desc">
          <text class="option-text">å¹´ä»½æœ€æ–°</text>
          <text class="option-check" wx:if="{{sortBy === 'year_desc'}}">âœ“</text>
        </view>
        <view class="sort-option {{sortBy === 'rating_desc' ? 'active' : ''}}" 
              bindtap="selectSort" 
              data-sort="rating_desc">
          <text class="option-text">è¯„åˆ†æœ€é«˜</text>
          <text class="option-check" wx:if="{{sortBy === 'rating_desc'}}">âœ“</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ç­›é€‰é¢æ¿ -->
  <view class="filter-panel" wx:if="{{showFilterPanel}}">
    <view class="panel-mask" bindtap="hideFilterPanel"></view>
    <view class="panel-content">
      <view class="panel-header">
        <text class="panel-title">ç­›é€‰æ¡ä»¶</text>
        <text class="panel-close" bindtap="hideFilterPanel">âœ•</text>
      </view>
      <scroll-view class="filter-content" scroll-y="{{true}}">
        <!-- å“ç‰Œç­›é€‰ -->
        <view class="filter-group">
          <text class="group-title">å“ç‰Œ</text>
          <view class="filter-options">
            <view class="filter-option {{selectedBrands.indexOf(item) !== -1 ? 'selected' : ''}}" 
                  wx:for="{{availableBrands}}" 
                  wx:key="*this"
                  bindtap="toggleBrand" 
                  data-brand="{{item}}">
              {{item}}
            </view>
          </view>
        </view>

        <!-- ç±»å‹ç­›é€‰ -->
        <view class="filter-group">
          <text class="group-title">ç±»å‹</text>
          <view class="filter-options">
            <view class="filter-option {{selectedCategories.indexOf(item) !== -1 ? 'selected' : ''}}" 
                  wx:for="{{availableCategories}}" 
                  wx:key="*this"
                  bindtap="toggleCategory" 
                  data-category="{{item}}">
              {{item}}
            </view>
          </view>
        </view>

        <!-- ä»·æ ¼ç­›é€‰ -->
        <view class="filter-group">
          <text class="group-title">ä»·æ ¼èŒƒå›´</text>
          <view class="price-range">
            <text>{{minPrice || 0}}ä¸‡ - {{maxPrice || 'ä¸é™'}}ä¸‡</text>
          </view>
          <view class="price-slider">
            <slider min="0" 
                    max="50" 
                    step="1" 
                    value="{{minPrice || 0}}" 
                    bindchange="onMinPriceChange" 
                    activeColor="#3b82f6"/>
            <slider min="0" 
                    max="50" 
                    step="1" 
                    value="{{maxPrice || 50}}" 
                    bindchange="onMaxPriceChange" 
                    activeColor="#3b82f6"/>
          </view>
        </view>
      </scroll-view>
      
      <view class="filter-actions">
        <button class="reset-btn" bindtap="resetFilters">é‡ç½®</button>
        <button class="apply-btn" bindtap="applyFilters">ç¡®å®š</button>
      </view>
    </view>
  </view>
</view>