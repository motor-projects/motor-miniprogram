<!--pages/profile/profile.wxml-->
<view class="page">
  <!-- ç”¨æˆ·ä¿¡æ¯ -->
  <view class="user-info card">
    <view class="user-header">
      <image src="{{userInfo.avatarUrl || '/images/default-avatar.png'}}" class="user-avatar" bindtap="chooseAvatar"></image>
      <view class="user-details">
        <text class="user-name">{{userInfo.nickName || 'æœªç™»å½•'}}</text>
        <text class="user-desc" wx:if="{{userInfo.nickName}}">æ‘©æ‰˜è½¦çˆ±å¥½è€…</text>
        <view class="login-section" wx:if="{{!userInfo.nickName}}">
          <button class="login-btn" bindtap="login" open-type="getUserProfile">
            å¾®ä¿¡ç™»å½•
          </button>
        </view>
      </view>
      <view class="user-actions" wx:if="{{userInfo.nickName}}">
        <text class="action-btn" bindtap="goToSettings">è®¾ç½®</text>
      </view>
    </view>
    
    <view class="user-stats" wx:if="{{userInfo.nickName}}">
      <view class="stat-item" bindtap="goToFavorites">
        <text class="stat-number">{{stats.favorites || 0}}</text>
        <text class="stat-label">æ”¶è—</text>
      </view>
      <view class="stat-item" bindtap="goToHistory">
        <text class="stat-number">{{stats.history || 0}}</text>
        <text class="stat-label">æµè§ˆ</text>
      </view>
      <view class="stat-item" bindtap="goToReviews">
        <text class="stat-number">{{stats.reviews || 0}}</text>
        <text class="stat-label">è¯„ä»·</text>
      </view>
      <view class="stat-item" bindtap="goToCompare">
        <text class="stat-number">{{compareCount || 0}}</text>
        <text class="stat-label">å¯¹æ¯”</text>
      </view>
    </view>
  </view>

  <!-- åŠŸèƒ½èœå• -->
  <view class="menu-section">
    <!-- æˆ‘çš„æ”¶è— -->
    <view class="menu-group card">
      <view class="menu-item" bindtap="goToFavorites">
        <view class="menu-icon">â™¡</view>
        <text class="menu-text">æˆ‘çš„æ”¶è—</text>
        <view class="menu-badge" wx:if="{{stats.favorites > 0}}">{{stats.favorites}}</view>
        <text class="menu-arrow">></text>
      </view>
      <view class="menu-item" bindtap="goToHistory">
        <view class="menu-icon">ğŸ•˜</view>
        <text class="menu-text">æµè§ˆå†å²</text>
        <view class="menu-badge" wx:if="{{stats.history > 0}}">{{stats.history}}</view>
        <text class="menu-arrow">></text>
      </view>
      <view class="menu-item" bindtap="goToCompare">
        <view class="menu-icon">âš–</view>
        <text class="menu-text">å¯¹æ¯”è½¦å‹</text>
        <view class="menu-badge" wx:if="{{compareCount > 0}}">{{compareCount}}</view>
        <text class="menu-arrow">></text>
      </view>
    </view>

    <!-- æˆ‘çš„è¯„ä»· -->
    <view class="menu-group card" wx:if="{{userInfo.nickName}}">
      <view class="menu-item" bindtap="goToReviews">
        <view class="menu-icon">â­</view>
        <text class="menu-text">æˆ‘çš„è¯„ä»·</text>
        <view class="menu-badge" wx:if="{{stats.reviews > 0}}">{{stats.reviews}}</view>
        <text class="menu-arrow">></text>
      </view>
      <view class="menu-item" bindtap="goToFeedback">
        <view class="menu-icon">ğŸ’¬</view>
        <text class="menu-text">æ„è§åé¦ˆ</text>
        <text class="menu-arrow">></text>
      </view>
    </view>

    <!-- è®¾ç½®å’ŒæœåŠ¡ -->
    <view class="menu-group card">
      <view class="menu-item" bindtap="goToSettings">
        <view class="menu-icon">âš™</view>
        <text class="menu-text">è®¾ç½®</text>
        <text class="menu-arrow">></text>
      </view>
      <view class="menu-item" bindtap="goToAbout">
        <view class="menu-icon">â„¹</view>
        <text class="menu-text">å…³äºæˆ‘ä»¬</text>
        <text class="menu-arrow">></text>
      </view>
      <view class="menu-item" bindtap="contactCustomerService">
        <view class="menu-icon">ğŸ“</view>
        <text class="menu-text">å®¢æœæ”¯æŒ</text>
        <text class="menu-arrow">></text>
      </view>
      <view class="menu-item" bindtap="shareApp">
        <view class="menu-icon">ğŸ“¤</view>
        <text class="menu-text">æ¨èç»™æœ‹å‹</text>
        <text class="menu-arrow">></text>
      </view>
    </view>

    <!-- ç‰ˆæœ¬ä¿¡æ¯ -->
    <view class="version-info">
      <text class="version-text">ç‰ˆæœ¬ {{version}}</text>
    </view>

    <!-- é€€å‡ºç™»å½• -->
    <view class="logout-section" wx:if="{{userInfo.nickName}}">
      <button class="logout-btn" bindtap="logout">é€€å‡ºç™»å½•</button>
    </view>
  </view>

  <!-- ç™»å½•æç¤º -->
  <view class="login-prompt" wx:if="{{!userInfo.nickName}}">
    <image src="/images/login-prompt.png" class="prompt-icon"></image>
    <text class="prompt-title">ç™»å½•åä½“éªŒæ›´å¤šåŠŸèƒ½</text>
    <text class="prompt-desc">æ”¶è—è½¦å‹ã€æŸ¥çœ‹å†å²ã€å‘è¡¨è¯„ä»·</text>
    <button class="prompt-login-btn" bindtap="login" open-type="getUserProfile">
      ç«‹å³ç™»å½•
    </button>
  </view>

  <!-- å¿«æ·æ“ä½œ -->
  <view class="quick-actions" wx:if="{{userInfo.nickName}}">
    <view class="action-grid">
      <view class="action-item" bindtap="goToFavorites">
        <view class="action-icon">â™¡</view>
        <text class="action-label">æ”¶è—</text>
      </view>
      <view class="action-item" bindtap="goToHistory">
        <view class="action-icon">ğŸ•˜</view>
        <text class="action-label">å†å²</text>
      </view>
      <view class="action-item" bindtap="goToCompare">
        <view class="action-icon">âš–</view>
        <text class="action-label">å¯¹æ¯”</text>
      </view>
      <view class="action-item" bindtap="shareApp">
        <view class="action-icon">ğŸ“¤</view>
        <text class="action-label">åˆ†äº«</text>
      </view>
    </view>
  </view>

  <!-- æ¨èåŠŸèƒ½ -->
  <view class="recommendations card" wx:if="{{recommendations.length > 0}}">
    <view class="section-header">
      <text class="section-title">ä¸ºä½ æ¨è</text>
    </view>
    <scroll-view class="recommendation-list" scroll-x="{{true}}">
      <view class="recommendation-item" 
            wx:for="{{recommendations}}" 
            wx:key="_id"
            bindtap="goToDetail" 
            data-id="{{item._id}}">
        <image src="{{item.images[0].url}}" class="recommendation-image"></image>
        <text class="recommendation-name">{{item.brand}} {{item.model}}</text>
        <text class="recommendation-price">Â¥{{item.price.msrp}}</text>
      </view>
    </scroll-view>
  </view>
</view>