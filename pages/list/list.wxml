<!--pages/list/list.wxml-->
<view class="page">
  <!-- 筛选栏 -->
  <view class="filter-bar">
    <view class="filter-item" bindtap="showBrandFilter">
      <text class="filter-text">{{selectedBrand || '品牌'}}</text>
      <text class="filter-arrow">{{showBrandPanel ? '▲' : '▼'}}</text>
    </view>
    <view class="filter-item" bindtap="showCategoryFilter">
      <text class="filter-text">{{selectedCategory || '类型'}}</text>
      <text class="filter-arrow">{{showCategoryPanel ? '▲' : '▼'}}</text>
    </view>
    <view class="filter-item" bindtap="showPriceFilter">
      <text class="filter-text">{{selectedPriceRange || '价格'}}</text>
      <text class="filter-arrow">{{showPricePanel ? '▲' : '▼'}}</text>
    </view>
    <view class="filter-item" bindtap="showSortFilter">
      <text class="filter-text">排序</text>
      <text class="filter-arrow">{{showSortPanel ? '▲' : '▼'}}</text>
    </view>
  </view>

  <!-- 品牌筛选面板 -->
  <view class="filter-panel" wx:if="{{showBrandPanel}}">
    <scroll-view class="filter-content" scroll-y="{{true}}">
      <view class="filter-option {{selectedBrand === '' ? 'active' : ''}}" 
            bindtap="selectBrand" data-brand="">
        全部品牌
      </view>
      <view class="filter-option {{selectedBrand === item ? 'active' : ''}}" 
            wx:for="{{brands}}" wx:key="*this"
            bindtap="selectBrand" data-brand="{{item}}">
        {{item}}
      </view>
    </scroll-view>
  </view>

  <!-- 类型筛选面板 -->
  <view class="filter-panel" wx:if="{{showCategoryPanel}}">
    <scroll-view class="filter-content" scroll-y="{{true}}">
      <view class="filter-option {{selectedCategory === '' ? 'active' : ''}}" 
            bindtap="selectCategory" data-category="">
        全部类型
      </view>
      <view class="filter-option {{selectedCategory === item ? 'active' : ''}}" 
            wx:for="{{categories}}" wx:key="*this"
            bindtap="selectCategory" data-category="{{item}}">
        {{item}}
      </view>
    </scroll-view>
  </view>

  <!-- 价格筛选面板 -->
  <view class="filter-panel" wx:if="{{showPricePanel}}">
    <view class="filter-content">
      <view class="price-range">
        <text>价格范围：{{minPrice || 0}}万 - {{maxPrice || '不限'}}万</text>
      </view>
      <view class="price-slider">
        <slider min="0" max="50" step="1" value="{{minPrice || 0}}" 
                bindchange="onMinPriceChange" activeColor="#3b82f6"/>
        <slider min="0" max="50" step="1" value="{{maxPrice || 50}}" 
                bindchange="onMaxPriceChange" activeColor="#3b82f6"/>
      </view>
      <view class="price-presets">
        <view class="preset-item" bindtap="selectPriceRange" data-range="0-5">5万以下</view>
        <view class="preset-item" bindtap="selectPriceRange" data-range="5-10">5-10万</view>
        <view class="preset-item" bindtap="selectPriceRange" data-range="10-20">10-20万</view>
        <view class="preset-item" bindtap="selectPriceRange" data-range="20-50">20万以上</view>
      </view>
    </view>
  </view>

  <!-- 排序筛选面板 -->
  <view class="filter-panel" wx:if="{{showSortPanel}}">
    <view class="filter-content">
      <view class="filter-option {{sortBy === 'default' ? 'active' : ''}}" 
            bindtap="selectSort" data-sort="default">
        默认排序
      </view>
      <view class="filter-option {{sortBy === 'price' && sortOrder === 'asc' ? 'active' : ''}}" 
            bindtap="selectSort" data-sort="price" data-order="asc">
        价格从低到高
      </view>
      <view class="filter-option {{sortBy === 'price' && sortOrder === 'desc' ? 'active' : ''}}" 
            bindtap="selectSort" data-sort="price" data-order="desc">
        价格从高到低
      </view>
      <view class="filter-option {{sortBy === 'year' && sortOrder === 'desc' ? 'active' : ''}}" 
            bindtap="selectSort" data-sort="year" data-order="desc">
        年份最新
      </view>
      <view class="filter-option {{sortBy === 'power' && sortOrder === 'desc' ? 'active' : ''}}" 
            bindtap="selectSort" data-sort="power" data-order="desc">
        动力最强
      </view>
      <view class="filter-option {{sortBy === 'rating' && sortOrder === 'desc' ? 'active' : ''}}" 
            bindtap="selectSort" data-sort="rating" data-order="desc">
        评分最高
      </view>
    </view>
  </view>

  <!-- 蒙层 -->
  <view class="mask" wx:if="{{showBrandPanel || showCategoryPanel || showPricePanel || showSortPanel}}" 
        bindtap="hidePanels"></view>

  <!-- 摩托车列表 -->
  <view class="motorcycle-list">
    <view class="list-header" wx:if="{{motorcycles.length > 0}}">
      <text class="total-count">共{{pagination.totalItems}}款摩托车</text>
      <view class="view-mode">
        <text class="mode-btn {{viewMode === 'grid' ? 'active' : ''}}" bindtap="changeViewMode" data-mode="grid">
          ⚏
        </text>
        <text class="mode-btn {{viewMode === 'list' ? 'active' : ''}}" bindtap="changeViewMode" data-mode="list">
          ☰
        </text>
      </view>
    </view>

    <!-- 网格视图 -->
    <view class="grid-view" wx:if="{{viewMode === 'grid'}}">
      <view class="grid-item" wx:for="{{motorcycles}}" wx:key="_id" 
            bindtap="goToDetail" data-id="{{item._id}}">
        <image src="{{item.images[0].url}}" class="motorcycle-image" mode="aspectFill"></image>
        <view class="motorcycle-info">
          <text class="motorcycle-name">{{item.brand}} {{item.model}}</text>
          <text class="motorcycle-year">{{item.year}}年</text>
          <text class="motorcycle-price">¥{{item.price.msrp}}</text>
          <view class="motorcycle-specs">
            <text class="spec-item">{{item.engine.displacement}}cc</text>
            <text class="spec-item">{{item.performance.power.hp}}HP</text>
          </view>
        </view>
        <view class="action-bar">
          <text class="favorite-btn {{item.isFavorited ? 'favorited' : ''}}" 
                bindtap="toggleFavorite" data-id="{{item._id}}" catchtap="true">
            ♡
          </text>
          <text class="compare-btn" bindtap="addToCompare" data-id="{{item._id}}" catchtap="true">
            对比
          </text>
        </view>
      </view>
    </view>

    <!-- 列表视图 -->
    <view class="list-view" wx:if="{{viewMode === 'list'}}">
      <view class="list-item" wx:for="{{motorcycles}}" wx:key="_id" 
            bindtap="goToDetail" data-id="{{item._id}}">
        <image src="{{item.images[0].url}}" class="motorcycle-image" mode="aspectFill"></image>
        <view class="motorcycle-info">
          <view class="info-header">
            <text class="motorcycle-name">{{item.brand}} {{item.model}}</text>
            <text class="motorcycle-year">{{item.year}}年</text>
          </view>
          <text class="motorcycle-price">¥{{item.price.msrp}}</text>
          <view class="motorcycle-specs">
            <text class="spec-item">排量：{{item.engine.displacement}}cc</text>
            <text class="spec-item">功率：{{item.performance.power.hp}}HP</text>
            <text class="spec-item">扭矩：{{item.performance.torque.nm}}N·m</text>
          </view>
          <view class="rating" wx:if="{{item.rating}}">
            <text class="rating-score">{{item.rating.overall}}</text>
            <text class="rating-text">{{item.rating.reviews}}条评价</text>
          </view>
        </view>
        <view class="action-bar">
          <text class="favorite-btn {{item.isFavorited ? 'favorited' : ''}}" 
                bindtap="toggleFavorite" data-id="{{item._id}}" catchtap="true">
            ♡
          </text>
          <text class="compare-btn" bindtap="addToCompare" data-id="{{item._id}}" catchtap="true">
            对比
          </text>
        </view>
      </view>
    </view>

    <!-- 加载更多 -->
    <view class="load-more" wx:if="{{hasMore && !loading}}">
      <text class="load-more-text" bindtap="loadMore">加载更多</text>
    </view>

    <!-- 加载中 -->
    <view class="loading" wx:if="{{loading}}">
      <text>加载中...</text>
    </view>

    <!-- 空状态 -->
    <view class="empty" wx:if="{{motorcycles.length === 0 && !loading}}">
      <image src="/images/empty-motorcycle.png" class="empty-icon"></image>
      <text class="empty-text">暂无相关摩托车</text>
      <text class="empty-tip">试试调整筛选条件</text>
    </view>
  </view>

  <!-- 对比浮窗 -->
  <view class="compare-float" wx:if="{{compareItems.length > 0}}">
    <view class="compare-content">
      <text class="compare-count">已选择{{compareItems.length}}款</text>
      <view class="compare-items">
        <image wx:for="{{compareItems}}" wx:key="_id" 
               src="{{item.images[0].url}}" class="compare-thumb"></image>
      </view>
      <button class="compare-btn-primary" bindtap="goToCompare">立即对比</button>
    </view>
  </view>
</view>