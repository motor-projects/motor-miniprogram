<!--pages/detail/detail.wxml-->
<view class="page">
  <!-- å›¾ç‰‡è½®æ’­ -->
  <swiper class="image-swiper" indicator-dots="{{true}}" indicator-color="rgba(255,255,255,0.5)" 
          indicator-active-color="#fff" circular="{{true}}">
    <swiper-item wx:for="{{motorcycle.images}}" wx:key="url" bindtap="previewImage" data-index="{{index}}">
      <image src="{{item.url}}" class="detail-image" mode="aspectFill"></image>
    </swiper-item>
  </swiper>

  <!-- åŸºæœ¬ä¿¡æ¯ -->
  <view class="basic-info card">
    <view class="info-header">
      <view class="title-section">
        <text class="motorcycle-name">{{motorcycle.brand}} {{motorcycle.model}}</text>
        <text class="motorcycle-year">{{motorcycle.year}}å¹´</text>
      </view>
      <view class="action-buttons">
        <view class="action-btn" bindtap="toggleFavorite">
          <text class="icon {{motorcycle.isFavorited ? 'favorited' : ''}}">â™¡</text>
          <text class="label">{{motorcycle.isFavorited ? 'å·²æ”¶è—' : 'æ”¶è—'}}</text>
        </view>
        <view class="action-btn" bindtap="shareMotorcycle">
          <text class="icon">â†—</text>
          <text class="label">åˆ†äº«</text>
        </view>
      </view>
    </view>
    
    <view class="price-section" wx:if="{{motorcycle.price}}">
      <text class="price-label">å‚å•†æŒ‡å¯¼ä»·</text>
      <text class="price-value">Â¥{{motorcycle.price.msrp}}</text>
    </view>

    <view class="rating-section" wx:if="{{motorcycle.rating}}">
      <view class="rating-score">
        <text class="score">{{motorcycle.rating.overall}}</text>
        <view class="stars">
          <text class="star {{index < motorcycle.rating.overall ? 'filled' : ''}}" 
                wx:for="{{[1,2,3,4,5]}}" wx:key="*this">â˜…</text>
        </view>
      </view>
      <text class="rating-text">{{motorcycle.rating.reviews}}æ¡è¯„ä»·</text>
      <text class="rating-link" bindtap="goToReviews">æŸ¥çœ‹å…¨éƒ¨ ></text>
    </view>

    <view class="quick-specs">
      <view class="spec-item">
        <text class="spec-label">æ’é‡</text>
        <text class="spec-value">{{motorcycle.engine.displacement}}cc</text>
      </view>
      <view class="spec-item">
        <text class="spec-label">åŠŸç‡</text>
        <text class="spec-value">{{motorcycle.performance.power.hp}}HP</text>
      </view>
      <view class="spec-item">
        <text class="spec-label">æ‰­çŸ©</text>
        <text class="spec-value">{{motorcycle.performance.torque.nm}}NÂ·m</text>
      </view>
      <view class="spec-item">
        <text class="spec-label">æœ€é«˜æ—¶é€Ÿ</text>
        <text class="spec-value">{{motorcycle.performance.topSpeed}}km/h</text>
      </view>
    </view>
  </view>

  <!-- å¯¼èˆªæ ‡ç­¾ -->
  <view class="nav-tabs">
    <view class="tab-item {{activeTab === 'specs' ? 'active' : ''}}" 
          bindtap="changeTab" data-tab="specs">
      æŠ€æœ¯å‚æ•°
    </view>
    <view class="tab-item {{activeTab === 'features' ? 'active' : ''}}" 
          bindtap="changeTab" data-tab="features">
      é…ç½®ç‰¹ç‚¹
    </view>
    <view class="tab-item {{activeTab === 'reviews' ? 'active' : ''}}" 
          bindtap="changeTab" data-tab="reviews">
      ç”¨æˆ·è¯„ä»·
    </view>
    <view class="tab-item {{activeTab === 'compare' ? 'active' : ''}}" 
          bindtap="changeTab" data-tab="compare">
      å¯¹æ¯”
    </view>
  </view>

  <!-- æŠ€æœ¯å‚æ•° -->
  <view class="content-section" wx:if="{{activeTab === 'specs'}}">
    <!-- å‘åŠ¨æœºå‚æ•° -->
    <view class="spec-group card" wx:if="{{motorcycle.engine}}">
      <view class="group-title">å‘åŠ¨æœºå‚æ•°</view>
      <view class="spec-list">
        <view class="spec-row" wx:if="{{motorcycle.engine.type}}">
          <text class="spec-name">å‘åŠ¨æœºç±»å‹</text>
          <text class="spec-content">{{motorcycle.engine.type}}</text>
        </view>
        <view class="spec-row" wx:if="{{motorcycle.engine.displacement}}">
          <text class="spec-name">æ’é‡</text>
          <text class="spec-content">{{motorcycle.engine.displacement}}cc</text>
        </view>
        <view class="spec-row" wx:if="{{motorcycle.engine.bore && motorcycle.engine.stroke}}">
          <text class="spec-name">ç¼¸å¾„Ã—è¡Œç¨‹</text>
          <text class="spec-content">{{motorcycle.engine.bore}}Ã—{{motorcycle.engine.stroke}}mm</text>
        </view>
        <view class="spec-row" wx:if="{{motorcycle.engine.compressionRatio}}">
          <text class="spec-name">å‹ç¼©æ¯”</text>
          <text class="spec-content">{{motorcycle.engine.compressionRatio}}</text>
        </view>
        <view class="spec-row" wx:if="{{motorcycle.engine.cooling}}">
          <text class="spec-name">å†·å´æ–¹å¼</text>
          <text class="spec-content">{{motorcycle.engine.cooling}}</text>
        </view>
        <view class="spec-row" wx:if="{{motorcycle.engine.fuelSystem}}">
          <text class="spec-name">ä¾›æ²¹æ–¹å¼</text>
          <text class="spec-content">{{motorcycle.engine.fuelSystem}}</text>
        </view>
        <view class="spec-row" wx:if="{{motorcycle.engine.maxRpm}}">
          <text class="spec-name">æœ€å¤§è½¬é€Ÿ</text>
          <text class="spec-content">{{motorcycle.engine.maxRpm}}rpm</text>
        </view>
      </view>
    </view>

    <!-- æ€§èƒ½å‚æ•° -->
    <view class="spec-group card" wx:if="{{motorcycle.performance}}">
      <view class="group-title">æ€§èƒ½å‚æ•°</view>
      <view class="spec-list">
        <view class="spec-row" wx:if="{{motorcycle.performance.power}}">
          <text class="spec-name">æœ€å¤§åŠŸç‡</text>
          <text class="spec-content">{{motorcycle.performance.power.hp}}HP / {{motorcycle.performance.power.kw}}kW @ {{motorcycle.performance.power.rpm}}rpm</text>
        </view>
        <view class="spec-row" wx:if="{{motorcycle.performance.torque}}">
          <text class="spec-name">æœ€å¤§æ‰­çŸ©</text>
          <text class="spec-content">{{motorcycle.performance.torque.nm}}NÂ·m / {{motorcycle.performance.torque.lbft}}lb-ft @ {{motorcycle.performance.torque.rpm}}rpm</text>
        </view>
        <view class="spec-row" wx:if="{{motorcycle.performance.topSpeed}}">
          <text class="spec-name">æœ€é«˜æ—¶é€Ÿ</text>
          <text class="spec-content">{{motorcycle.performance.topSpeed}}km/h</text>
        </view>
        <view class="spec-row" wx:if="{{motorcycle.performance.acceleration}}">
          <text class="spec-name">0-100km/håŠ é€Ÿ</text>
          <text class="spec-content">{{motorcycle.performance.acceleration.zeroToHundred}}ç§’</text>
        </view>
        <view class="spec-row" wx:if="{{motorcycle.performance.fuelEconomy}}">
          <text class="spec-name">æ²¹è€—</text>
          <text class="spec-content">å¸‚åŒº{{motorcycle.performance.fuelEconomy.city}}L/100km, éƒŠåŒº{{motorcycle.performance.fuelEconomy.highway}}L/100km</text>
        </view>
      </view>
    </view>

    <!-- è½¦èº«å‚æ•° -->
    <view class="spec-group card" wx:if="{{motorcycle.dimensions}}">
      <view class="group-title">è½¦èº«å‚æ•°</view>
      <view class="spec-list">
        <view class="spec-row" wx:if="{{motorcycle.dimensions.length}}">
          <text class="spec-name">è½¦èº«å°ºå¯¸(é•¿Ã—å®½Ã—é«˜)</text>
          <text class="spec-content">{{motorcycle.dimensions.length}}Ã—{{motorcycle.dimensions.width}}Ã—{{motorcycle.dimensions.height}}mm</text>
        </view>
        <view class="spec-row" wx:if="{{motorcycle.dimensions.wheelbase}}">
          <text class="spec-name">è½´è·</text>
          <text class="spec-content">{{motorcycle.dimensions.wheelbase}}mm</text>
        </view>
        <view class="spec-row" wx:if="{{motorcycle.dimensions.seatHeight}}">
          <text class="spec-name">åº§é«˜</text>
          <text class="spec-content">{{motorcycle.dimensions.seatHeight}}mm</text>
        </view>
        <view class="spec-row" wx:if="{{motorcycle.dimensions.groundClearance}}">
          <text class="spec-name">ç¦»åœ°é—´éš™</text>
          <text class="spec-content">{{motorcycle.dimensions.groundClearance}}mm</text>
        </view>
        <view class="spec-row" wx:if="{{motorcycle.dimensions.weight}}">
          <text class="spec-name">æ•´å¤‡è´¨é‡</text>
          <text class="spec-content">{{motorcycle.dimensions.weight.wet}}kg</text>
        </view>
        <view class="spec-row" wx:if="{{motorcycle.dimensions.fuelCapacity}}">
          <text class="spec-name">æ²¹ç®±å®¹ç§¯</text>
          <text class="spec-content">{{motorcycle.dimensions.fuelCapacity}}L</text>
        </view>
      </view>
    </view>

    <!-- ä¼ åŠ¨ç³»ç»Ÿ -->
    <view class="spec-group card" wx:if="{{motorcycle.transmission}}">
      <view class="group-title">ä¼ åŠ¨ç³»ç»Ÿ</view>
      <view class="spec-list">
        <view class="spec-row" wx:if="{{motorcycle.transmission.type}}">
          <text class="spec-name">å˜é€Ÿç®±</text>
          <text class="spec-content">{{motorcycle.transmission.type}}</text>
        </view>
        <view class="spec-row" wx:if="{{motorcycle.transmission.gears}}">
          <text class="spec-name">æ¡£ä½æ•°</text>
          <text class="spec-content">{{motorcycle.transmission.gears}}æ¡£</text>
        </view>
      </view>
    </view>

    <!-- æ‚¬æŒ‚åˆ¶åŠ¨ -->
    <view class="spec-group card">
      <view class="group-title">æ‚¬æŒ‚åˆ¶åŠ¨</view>
      <view class="spec-list">
        <view class="spec-row" wx:if="{{motorcycle.suspension.front}}">
          <text class="spec-name">å‰æ‚¬æŒ‚</text>
          <text class="spec-content">{{motorcycle.suspension.front}}</text>
        </view>
        <view class="spec-row" wx:if="{{motorcycle.suspension.rear}}">
          <text class="spec-name">åæ‚¬æŒ‚</text>
          <text class="spec-content">{{motorcycle.suspension.rear}}</text>
        </view>
        <view class="spec-row" wx:if="{{motorcycle.brakes.front}}">
          <text class="spec-name">å‰åˆ¶åŠ¨</text>
          <text class="spec-content">{{motorcycle.brakes.front}}</text>
        </view>
        <view class="spec-row" wx:if="{{motorcycle.brakes.rear}}">
          <text class="spec-name">ååˆ¶åŠ¨</text>
          <text class="spec-content">{{motorcycle.brakes.rear}}</text>
        </view>
        <view class="spec-row" wx:if="{{motorcycle.brakes.abs}}">
          <text class="spec-name">ABS</text>
          <text class="spec-content">{{motorcycle.brakes.abs ? 'æœ‰' : 'æ— '}}</text>
        </view>
      </view>
    </view>

    <!-- è½®èƒè½®æ¯‚ -->
    <view class="spec-group card" wx:if="{{motorcycle.wheels}}">
      <view class="group-title">è½®èƒè½®æ¯‚</view>
      <view class="spec-list">
        <view class="spec-row" wx:if="{{motorcycle.wheels.front}}">
          <text class="spec-name">å‰è½®</text>
          <text class="spec-content">{{motorcycle.wheels.front.size}} / {{motorcycle.wheels.front.tire}}</text>
        </view>
        <view class="spec-row" wx:if="{{motorcycle.wheels.rear}}">
          <text class="spec-name">åè½®</text>
          <text class="spec-content">{{motorcycle.wheels.rear.size}} / {{motorcycle.wheels.rear.tire}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- é…ç½®ç‰¹ç‚¹ -->
  <view class="content-section" wx:if="{{activeTab === 'features'}}">
    <view class="features-grid card" wx:if="{{motorcycle.features && motorcycle.features.length > 0}}">
      <view class="group-title">ä¸»è¦é…ç½®</view>
      <view class="feature-list">
        <view class="feature-item" wx:for="{{motorcycle.features}}" wx:key="*this">
          <text class="feature-icon">âœ“</text>
          <text class="feature-text">{{item}}</text>
        </view>
      </view>
    </view>

    <view class="colors-section card" wx:if="{{motorcycle.colors && motorcycle.colors.length > 0}}">
      <view class="group-title">å¯é€‰é¢œè‰²</view>
      <view class="color-list">
        <view class="color-item" wx:for="{{motorcycle.colors}}" wx:key="name">
          <view class="color-swatch" style="background-color: {{item.hex}}"></view>
          <text class="color-name">{{item.name}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ç”¨æˆ·è¯„ä»· -->
  <view class="content-section" wx:if="{{activeTab === 'reviews'}}">
    <view class="reviews-summary card" wx:if="{{motorcycle.rating}}">
      <view class="summary-header">
        <view class="overall-rating">
          <text class="rating-score">{{motorcycle.rating.overall}}</text>
          <view class="rating-stars">
            <text class="star {{index < motorcycle.rating.overall ? 'filled' : ''}}" 
                  wx:for="{{[1,2,3,4,5]}}" wx:key="*this">â˜…</text>
          </view>
          <text class="rating-count">åŸºäº{{motorcycle.rating.reviews}}æ¡è¯„ä»·</text>
        </view>
      </view>

      <view class="rating-breakdown" wx:if="{{motorcycle.rating.breakdown}}">
        <view class="breakdown-item">
          <text class="breakdown-label">æ€§èƒ½</text>
          <view class="breakdown-bar">
            <view class="breakdown-fill" style="width: {{motorcycle.rating.breakdown.performance * 20}}%"></view>
          </view>
          <text class="breakdown-score">{{motorcycle.rating.breakdown.performance}}</text>
        </view>
        <view class="breakdown-item">
          <text class="breakdown-label">èˆ’é€‚</text>
          <view class="breakdown-bar">
            <view class="breakdown-fill" style="width: {{motorcycle.rating.breakdown.comfort * 20}}%"></view>
          </view>
          <text class="breakdown-score">{{motorcycle.rating.breakdown.comfort}}</text>
        </view>
        <view class="breakdown-item">
          <text class="breakdown-label">å¯é æ€§</text>
          <view class="breakdown-bar">
            <view class="breakdown-fill" style="width: {{motorcycle.rating.breakdown.reliability * 20}}%"></view>
          </view>
          <text class="breakdown-score">{{motorcycle.rating.breakdown.reliability}}</text>
        </view>
        <view class="breakdown-item">
          <text class="breakdown-label">æ€§ä»·æ¯”</text>
          <view class="breakdown-bar">
            <view class="breakdown-fill" style="width: {{motorcycle.rating.breakdown.value * 20}}%"></view>
          </view>
          <text class="breakdown-score">{{motorcycle.rating.breakdown.value}}</text>
        </view>
        <view class="breakdown-item">
          <text class="breakdown-label">å¤–è§‚</text>
          <view class="breakdown-bar">
            <view class="breakdown-fill" style="width: {{motorcycle.rating.breakdown.styling * 20}}%"></view>
          </view>
          <text class="breakdown-score">{{motorcycle.rating.breakdown.styling}}</text>
        </view>
      </view>
    </view>

    <view class="reviews-list">
      <view class="review-item card" wx:for="{{reviews}}" wx:key="_id">
        <view class="review-header">
          <image src="{{item.user.avatar || '/images/default-avatar.png'}}" class="user-avatar"></image>
          <view class="review-info">
            <text class="user-name">{{item.user.username}}</text>
            <view class="review-rating">
              <text class="star {{index < item.rating.overall ? 'filled' : ''}}" 
                    wx:for="{{[1,2,3,4,5]}}" wx:key="*this">â˜…</text>
            </view>
            <text class="review-date">{{item.createdAt}}</text>
          </view>
        </view>
        <text class="review-title">{{item.title}}</text>
        <text class="review-content">{{item.content}}</text>
        <view class="review-images" wx:if="{{item.images && item.images.length > 0}}">
          <image wx:for="{{item.images}}" wx:key="*this" src="{{item}}" class="review-image" 
                 mode="aspectFill" bindtap="previewReviewImage" data-images="{{item.images}}" data-current="{{item}}"></image>
        </view>
        <view class="review-actions">
          <text class="helpful-btn {{item.isHelpful ? 'active' : ''}}" bindtap="toggleHelpful" data-id="{{item._id}}">
            ğŸ‘ æœ‰ç”¨ {{item.helpful.count}}
          </text>
        </view>
      </view>
    </view>

    <view class="load-more-reviews" wx:if="{{hasMoreReviews}}">
      <text class="load-more-btn" bindtap="loadMoreReviews">åŠ è½½æ›´å¤šè¯„ä»·</text>
    </view>

    <view class="empty-reviews" wx:if="{{reviews.length === 0}}">
      <text>æš‚æ— è¯„ä»·ï¼Œæˆä¸ºç¬¬ä¸€ä¸ªè¯„ä»·çš„äººå§</text>
    </view>
  </view>

  <!-- å¯¹æ¯” -->
  <view class="content-section" wx:if="{{activeTab === 'compare'}}">
    <view class="compare-section card">
      <view class="group-title">æ·»åŠ å¯¹æ¯”</view>
      <view class="compare-current">
        <image src="{{motorcycle.images[0].url}}" class="compare-image"></image>
        <text class="compare-name">{{motorcycle.brand}} {{motorcycle.model}}</text>
      </view>
      
      <view class="compare-actions">
        <button class="compare-btn" bindtap="addToCompare">
          {{isInCompare ? 'å·²åŠ å…¥å¯¹æ¯”' : 'åŠ å…¥å¯¹æ¯”'}}
        </button>
        <button class="compare-btn primary" bindtap="goToCompare" wx:if="{{compareCount > 1}}">
          æŸ¥çœ‹å¯¹æ¯” ({{compareCount}})
        </button>
      </view>

      <view class="compare-similar">
        <view class="group-title">ç›¸ä¼¼è½¦å‹</view>
        <scroll-view class="similar-list" scroll-x="{{true}}">
          <view class="similar-item" wx:for="{{similarMotorcycles}}" wx:key="_id" 
                bindtap="goToDetail" data-id="{{item._id}}">
            <image src="{{item.images[0].url}}" class="similar-image"></image>
            <text class="similar-name">{{item.brand}} {{item.model}}</text>
            <text class="similar-price">Â¥{{item.price.msrp}}</text>
          </view>
        </scroll-view>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œæ  -->
  <view class="bottom-actions">
    <button class="action-btn outline" bindtap="goToReviews">
      æŸ¥çœ‹è¯„ä»·
    </button>
    <button class="action-btn outline" bindtap="addToCompare">
      {{isInCompare ? 'å·²åŠ å…¥å¯¹æ¯”' : 'åŠ å…¥å¯¹æ¯”'}}
    </button>
    <button class="action-btn primary" bindtap="contactDealer" wx:if="{{motorcycle.dealer}}">
      è”ç³»ç»é”€å•†
    </button>
    <button class="action-btn primary" open-type="share">
      åˆ†äº«
    </button>
  </view>
</view>